#!/bin/bash -e
# install packages with equivs
# Copyright 2018 Osamu Aoki <osamu@debian.org>, GPL-2+
# vim: set ts=2 sts=2 sw=2 ai et:
#############################################################################
if [ "$1" = "-s" ]; then
  echo
  echo "... Simulation ... no actual install"
  echo
  OPTS="-s"
  shift
elif [ "$1" = "-c" ]; then
  echo
  echo "... Check ... no actual install"
  echo
  OPTS="-c"
  shift
else
  OPTS=""
fi
#############################################################################
if [ "$OPTS" != "-c" ]; then
  cat /etc/os-release
fi
# VERSION_ID
#  7: wheezy  = 2013-
#  8: jessie  = 2015-
#  9: stretch = 2017-
# 10: buster  = 2019?
# 11: bullseye
# 12: Bookworm
#############################################################################
if [ -z "$1" ]; then
  echo "1) Console only Desktop"
  echo "2) GUI Desktop (GNOME) 5 GB"
  echo "3) Developer Desktop (C, Python3, ...) 7 GB"
  echo "4) ... + Documentation"
  echo "5) ... + TeX tools 13 GB"
  echo "6) ... + All extras"
  read -p "Enter your choice (1-6): " CHOICE
else
  CHOICE="$1"
fi
echo
case $CHOICE in
  "2") echo "Install 'GUI Desktop (GNOME)'"
    PACKAGES="$(cat ~/.debrc |\
      sed -e 's/@GUI@//' |\
      sed -e 's/@DEV@/#/' |\
      sed -e 's/@DOC@/#/' |\
      sed -e 's/@TEX@/#/' |\
      sed -e 's/@ALL@/#/' |\
      sed -e 's/#.*$//' |xargs -n1)"
          ;;
  "3") echo "Install 'Developer Desktop (C, Python3, ...)'"
    PACKAGES="$(cat ~/.debrc |\
      sed -e 's/@GUI@//' |\
      sed -e 's/@DEV@//' |\
      sed -e 's/@DOC@/#/' |\
      sed -e 's/@TEX@/#/' |\
      sed -e 's/@ALL@/#/' |\
      sed -e 's/#.*$//' |xargs -n1)"
          ;;
  "4")  echo "Install 'Developer Desktop (C, Python3, ...) + Documentation'"
    PACKAGES="$(cat ~/.debrc |\
      sed -e 's/@GUI@//' |\
      sed -e 's/@DEV@//' |\
      sed -e 's/@DOC@//' |\
      sed -e 's/@TEX@/#/' |\
      sed -e 's/@ALL@/#/' |\
      sed -e 's/#.*$//' |xargs -n1)"
          ;;
  "5")  echo "Install 'Developer Desktop (C, Python3, TeX, ...) + Documentation'"
    PACKAGES="$(cat ~/.debrc |\
      sed -e 's/@GUI@//' |\
      sed -e 's/@DEV@//' |\
      sed -e 's/@DOC@//' |\
      sed -e 's/@TEX@//' |\
      sed -e 's/@ALL@/#/' |\
      sed -e 's/#.*$//' |xargs -n1)"
          ;;
  "6") echo "Install 'Developer Desktop (All)'"
    PACKAGES="$(cat ~/.debrc |\
      sed -e 's/@GUI@//' |\
      sed -e 's/@DEV@//' |\
      sed -e 's/@DOC@//' |\
      sed -e 's/@TEX@//' |\
      sed -e 's/@ALL@//' |\
      sed -e 's/#.*$//' |xargs -n1)"
          ;;
  *) echo "Install 'Console only Desktop'"
    PACKAGES="$(cat ~/.debrc |\
      sed -e 's/@GUI@/#/' |\
      sed -e 's/@DEV@/#/' |\
      sed -e 's/@DOC@/#/' |\
      sed -e 's/@TEX@/#/' |\
      sed -e 's/@ALL@/#/' |\
      sed -e 's/#.*$//' |xargs -n1)"
esac
if [ "$OPTS" = "-c" ]; then
  echo "-----------------------------------------------------------------------"
  aptitude search '~i!~prequired!~pimportant!~pstandard!~M' | \
  grep -v "$(echo -n '\(';echo -n "$PACKAGES" | sed -e 's/^/^i  /g' | sed -e 's/$/ - \\|/g' | tr -d '\n';echo -n 'XXX_NON_EXISTING_PACKAGE_XXX\)')"
  echo "-----------------------------------------------------------------------"
  exit 0
fi

echo "-----------------------------------------------------------------------"
echo $PACKAGES
echo "-----------------------------------------------------------------------"
read -p "Type 'RETURN'-key to instell above packages (otherwise ^C to stop here)." FOO
sudo apt update
sudo apt install $OPTS $PACKAGES
