# vim:sts=4 ai:
#Local configuration 
MAILROOT="$HOME/Maildir"
MAILHOST="localhost"
VARMAILUSER="osamu"
VERBOSE=1
logfile $HOME/.maildroplog

# rules are made to override the earlier value by the later one.

# mailing list mails ?
if (     /^Precedence:.*list/:h || /^Precedence:.*bulk/:h || /^Precedence:.*junk/:h )
{
    # rules for mailing list mails
    # default mailbox for mails from mailing list
    MAILBOX="Inbox-list"
    if ( /^List-Id:.*<[^<>]*\.qa\.debian\.org>/:h  ||\
	/^List-Id:.*<[^<>]*\.tracker\.debian\.org>/:h )
    {
    # mailbox for mailing list for QA.debian.org (PTS, upload, ...)
    # mailbox for mailing list for tracker.debian.org
        MAILBOX="Inbox-debian"
    }
    elsif ( /From: .*courier-.*@lists.sourceforge.net/:h )
    {
    # mailbox for mailing list for google
        MAILBOX="Inbox-courier"
    }
    elsif ( /From: .*eBay@reply1.ebay.com/:h || \
         /From: .*digital-.*@asahi.com/:h || \
         /From: .*<info[-_@]/:h ||\
         /From: .*<news[-_@]/:h ||\
         /From: .*<no[-_]reply[-_@]/:h ||\
         /From: .*<noreply.*@/:h )
    {
    # mailbox for mailing list for google
        MAILBOX="Inbox-list-news"
    }
    elsif ( /^List-Id:.*<([^<>]*)>/:h )
    {
    # mailbox for mailing list with "List-Id: ...<foo.bar>"
        MAILBOX="$MATCH1"
    }
    elsif ( /^List-Post:.*<mailto: *([^<> ]*)>/:h )
    {
	# ezmlm style: List-Post: <mailto:getmail@lists.pyropus.ca>
        MAILBOX="$MATCH1"
    }
    elsif ( /^(Sender|Resent-From|Resent-Sender|From|Return-Path): .*rt.spi-inc.org/:h )
    {
	# default mailbox for mails from rt.spi-inc.org
        MAILBOX="Inbox-rt-spi-inc"
    }
    elsif ( /^(Sender|Resent-From|Resent-Sender|From|Return-Path): .*debian.org/:h )
    {
	# default mailbox for mails from debian.org
        MAILBOX="Inbox-debian"
    }
}
else
{
    # rules for non-mailing list mails
    # incoming box (non-mailing list)
    MAILBOX="Inbox"
    if ( /From: .*@ekupi.hr/:h ||\
         /From: .*@n4sonline.com/:h ||\
         /From: .*@quora.com/:h ||\
         /From: .*Groupon Indonesia/:h ||\
         /From: .*distribuidoraguarapuava.com.br/:h ||\
         /From: .*marketingbooster@yahoo.co.uk/:h ||\
         /From: .*omssrilak.*@gmail.com/:h ||\
         /From: .*vivaaerobus.com/:h )
    {
    # black list for spam mails
        MAILBOX="Inbox-spam"
    }
    elsif ( /From: .*@connpass.com/:h ||\
            /From: .*@github.com/:h ||\
            /From: .*info@so-net.ne.jp/:h ||\
            /From: .*@kognitiv.com/:h ||\
            /From: .*tokyo2020.jp/:h ||\
            /From: .*@ticket.tokyo2020.org/:h ||\
            /From: .*@accounts.google.com/:h )
    {
    # white list for inbox
        MAILBOX="Inbox"
    }
    elsif ( /^Subject: Validation failed/:h )
    {
    # web page validation
        MAILBOX="Inbox-debian-validation"
    }
    elsif( /^(Sender|Resent-From|Resent-Sender): .*debian.org/:h ||\
	/^Subject: .*Bug#.*/:h ||\
        /^(From|To|Cc): .*@bugs.debian.org/:h )
    {
    # mails from debian.org (non-mailing list)
    # mails for Debian BTS (non-mailing list)
        MAILBOX="Inbox-debian"
    }
    elsif ( /Envelope-to: .*@$MAILHOST/:h ||\
	/Envelope-to: .*@goofy/:h )
    {
    # local mails (non-mailing list)
        MAILBOX="Inbox-local"
    }
    elsif ( /From: .*info@fujimaki-select.com/:h ||\
         /From: .*-master@mail.yahoo.co.jp/:h ||\
         /From: .*@.*canon-mj.co.jp/:h || \
         /From: .*@.*dynabook.com/:h || \
         /From: .*@.*facebookmail.com/:h || \
         /From: .*@.*hp.com/:h || \
         /From: .*@.*lenovo.com/:h || \
         /From: .*@.*linkedin.com/:h || \
         /From: .*@.*pinterest.com>/:h || \
         /From: .*@.*thelalu.com.tw/:h ||\
         /From: .*@.*tokyu.jp/:h || \
         /From: .*@.*twitter.com/:h || \
         /From: .*anamagazine@.*ana.co.jp/:h || \
         /From: .*bounce@mail.mecsumai.com/:h ||\
         /From: .*jmbtournews@.*jal.com/:h || \
         /From: .*paypal@.*.paypal.com/:h || \
         /From: .*pontaweb@point.recruit.co.jp/:h ||\
         /From: .*ymall@tpgaw.jp/:h ||\
         /From: .*yoyaku@expy.jp/:h ||\
         /From: .*rhnewsletter-jp@redhat.com/:h ||\
         /From: .*nomura-shomen@jp.nomura.com/:h ||\
         /From: .*<delivers-master[-_@]/:h ||\
         /From: .*<donotreply[-_@]/:h ||\
         /From: .*<info[-_@]/:h ||\
         /From: .*<mailnews[-_@]/:h ||\
         /From: .*<messages[-_]noreply[-_@]/:h ||\
         /From: .*<news[-_@]/:h ||\
         /From: .*<newsletter[-_@]/:h ||\
         /From: .*<newsmaster[-_@]/:h ||\
         /From: .*<no[-_]reply[-_@]/:h ||\
         /From: .*<noreply[-_@]/:h ||\
         /From: .*<notifications-noreply@/:h ||\
         /From: .*<promotion@/:h ||\
         /From: .*<service[-_@]/:h )
    {
    # junk mails
        MAILBOX="Inbox-frequent"
    }
    elsif ( /From: .*<announce[-_]noreply[-_@]/:h ||\
         /From: .*<service[-_@]/:h )
    {
    # junk mails
        MAILBOX="Inbox-infrequent"
    }
}

# if not Inbox, put them into subfolders
if ( ! ( "$MAILBOX" =~ /^Inbox$/ ) )
{
	MAILBOX=`echo $MAILBOX |sed -e "s/[.@_ ]/-/g" -e "s/^/\./"`
}
# check existance of $MAILBOX
`test -d $MAILROOT/$MAILBOX`
if ( $RETURNCODE == 1 )
{
    # create maildir mailbox for $MAILBOX
    `maildirmake $MAILROOT/$MAILBOX`
}
# deliver to maildir $MAILBOX (loop check)
#cc "/var/mail/$VARMAILUSER"

# deliver to home directory
to "$MAILROOT/$MAILBOX/"
exit

